
@{
    ViewBag.Title = "RecruitIndex";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="layui-tab layui-tab-card">
    <ul class="layui-tab-title">
        <li class="layui-this">招聘追踪记录</li>
        <li>月度招聘数据汇总</li>
    </ul>

    <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
            @*模糊查询*@
            <fieldset>
                <legend>条件查询</legend>
                <form class="layui-form" action="" lay-filter="formtrace">
                    <div class="layui-row layui-form-item">
                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:</label>
                            <div class="layui-input-inline" style="margin-left:10px;">
                                <input type="text" id="Name" name="Name" autocomplete="off" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label" style="width:100px;">部&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;门:</label>
                            <div class="layui-input-inline">
                                <select name="deptid1" id="deptid1" style="width:130px;" lay-filter="deptid1filter" lay-search=""></select>

                            </div>
                        </div>

                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label" style="width:100px;margin-left:-20px;">岗&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;位:</label>
                            <div class="layui-input-inline">
                                <select name="Pid1" id="Pid1" lay-filter="pid1filter" style="width:130px;">
                                    <option value="">请选择应聘的岗位</option>
                                </select>
                            </div>
                        </div>

                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label" style="width:100px;margin-left:-20px;">联系电话:</label>
                            <div class="layui-input-inline">
                                <input type="text" id="PhoneNumber" name="PhoneNumber" autocomplete="off" class="layui-input">
                            </div>
                        </div>

                    </div>
                    <div class="layui-row layui-form-item">
                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label">渠&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;道:</label>
                            <div class="layui-input-inline" style="margin-left:10px;">
                                <input type="text" id="Channel" name="Channel" autocomplete="off" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label" style="width:100px;">简历类型:</label>
                            <div class="layui-input-inline">
                                <input type="text" id="ResumeType" name="ResumeType" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3" style="margin-left:-20px;">
                            <label class="layui-form-label" style="width:100px;">面试结果:</label>
                            <div class="layui-input-inline">
                                <select name="result" id="result">
                                    <option value="">--请选择--</option>
                                    <option value="false">未通过</option>
                                    <option value="true">已通过</option>
                                </select>

                            </div>
                        </div>

                        <div class="layui-col-xs3 layui-col-sm3 layui-col-md3">
                            <label class="layui-form-label" style="width:100px;">是否入职:</label>
                            <div class="layui-input-inline">
                                <select name="IsEntry" id="IsEntry">
                                    <option value="">--请选择--</option>
                                    <option value="false">未入职</option>
                                    <option value="true">已入职</option>
                                </select>

                            </div>
                        </div>


                    </div>
                    <div class="layui-row layui-form-item">
                        <div class="layui-inline" style="margin-left:-13px;">
                            <label class="layui-form-label" style="width:100px;margin-left:10px;">联系时间:</label>
                            <div class="layui-inline" style="margin-left:-50px;">
                                <label class="layui-form-label">从:</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="start_TraceTime" name="start_TraceTime" lay-verify="start_TraceTime" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-inline" style="margin-left:-50px;">
                                <label class="layui-form-label">至:</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="end_TraceTime" name="end_TraceTime" lay-verify="end_TraceTime" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>

                        <div class="layui-inline">
                            <label class="layui-form-label" style="width:120px;margin-left:-20px;">预面试时间:</label>
                            <div class="layui-inline" style="margin-left:-40px;">
                                <label class="layui-form-label">从:</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="start_ForwardDate" name="start_ForwardDate" lay-verify="start_ForwardDate" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-inline" style="margin-left:-50px;">
                                <label class="layui-form-label">至:</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="end_ForwardDate" name="end_ForwardDate" lay-verify="end_ForwardDate" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <button class="layui-btn" type="button" id="Conditionselect1" style="margin-left:40px;"><i class="layui-icon layui-icon-search"></i>查询</button>
                    </div>
                </form>
            </fieldset>

            <table id="rptTab" lay-filter="rptTab"></table>
            @*头部工具栏*@
            <script type="text/html" id="toolbarDemo2">
                <div class="layui-btn-container">
                    <button class="layui-btn layui-btn-sm" lay-event="addRPT"><i class="layui-icon layui-icon-addition"></i>添加招聘追踪数据</button>
                </div>
            </script>
            @*操作栏*@
            <script type="text/html" id="barDemo">
                <a class="layui-btn layui-btn-xs" lay-event="addTrack">添加追踪</a>
                <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                <a class="layui-btn layui-btn-xs" lay-event="Entry">入职</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="detail">查看详情</a>
            </script>
        </div>
        <div class="layui-tab-item">
            @*月度汇总模糊查询*@
            <form class="layui-form" action="" lay-filter="formtest">
                <div class="layui-row layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:100px;margin-left:-20px;">部门:</label>
                        <div class="layui-input-inline">
                            <select name="deptid" id="deptid" style="width:130px;" lay-filter="deptidfilter" lay-search=""></select>

                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:100px;">岗位</label>
                        <div class="layui-input-block">
                            <select name="Pid" id="Pid" lay-filter="pidfilter">
                                <option value="">请选择应聘的岗位</option>
                            </select>
                        </div>
                    </div>

                    <div class="layui-inline">
                        <label class="layui-form-label" style="width:100px;">年月份：</label>
                        <div class="layui-inline" style="margin-left:-50px;">
                            <label class="layui-form-label">从：</label>
                            <div class="layui-input-inline">
                                <input type="text" id="start_time" name="start_time" placeholder="yyyy-MM" lay-verify="start_time" autocomplete="off" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-inline" style="margin-left:-50px;">
                            <label class="layui-form-label">至：</label>
                            <div class="layui-input-inline">
                                <input type="text" id="end_time" name="start_time" placeholder="yyyy-MM" lay-verify="end_time" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <button class="layui-btn" type="button" id="Conditionselect" style="margin-left:160px;"><i class="layui-icon layui-icon-search"></i>查询</button>
                </div>
            </form>

            <table id="recruitTab" lay-filter="recruitTab"></table>
        </div>

    </div>
</div>

@*招聘电话追踪记录的面试结果属性*@
<script type="text/html" id="switchTp2">
    {{# if(d.IsEntry==false){ }}
    {{ d.IsEntry="未入职" }}
    {{# }else{ }}
    {{ d.IsEntry="已入职" }}
    {{# } }}
</script>


@*招聘电话追踪记录的面试结果属性*@
<script type="text/html" id="faceresult">
    {{# if(d.result==false){ }}
    {{ d.result="未通过" }}
    {{# }else{ }}
    {{ d.result="已通过" }}
    {{# } }}
</script>

@section script{
    <script>

        //招聘电话追踪数据
        layui.use(['table', 'layer', 'form', 'laydate', 'element'], function () {
            var table = layui.table;
            var layer = layui.layer;
            var form = layui.form;
            var laydate = layui.laydate;
            var element = layui.element;
            table.render({
                elem: '#rptTab'
                , url: '/Personnelmatters/RecruitingDataSummary/GetTraceData'
                , id: "myrptData"
                , toolbar: '#toolbarDemo2'
                , limits: [5, 10, 20, 30, 40, 50, 60]
                , limit: 10
                , cols: [[
                    { field: 'Name', title: '姓名', sort: true, width: 90 }
                    , { field: 'Dname', title: '应聘部门', sort: true, width: 130 }
                    , { field: 'Pname', title: '应聘岗位', sort: true, width: 130 }
                    , { field: 'PhoneNumber', title: '手机号', width: 125, sort: true }
                    , { field: 'TraceTime', title: '联系时间', width: 170, sort: true, templet: function (d) { return changeDateTimeFormat(d.TraceTime); } }
                    , { field: 'Channel', title: '渠道', width: 95, sort: true }
                    , { field: 'ResumeType', title: '简历类型', sort: true, width: 110 }
                    , { field: 'forwardDate', title: '预面试时间', width: 170, sort: true, templet: function (d) { return changeDateTimeFormat(d.forwardDate); } }
                    , { field: 'result', title: '面试结果', width: 100, templet: '#faceresult' }
                    , { field: 'IsEntry', title: '是否入职', width: 100, templet: '#switchTp2' }
                    , { field: 'Remark', title: '备注', sort: true, width: 90 }
                    , { fixed: 'right', title: '操作', toolbar: '#barDemo' }
                ]]
                , page: true
            });

            //模糊查询点击事件
            $("#Conditionselect1").click(function () {
                var name = $("#Name").val();
                var deptid = $("#deptid1").val();
                console.log(deptid);
                var pid = $("#Pid1").val();//员工所属岗位
                var PhoneNumber = $("#PhoneNumber").val();
                var Channel = $("#Channel").val();
                var ResumeType = $("#ResumeType").val();
                var result = $("#result").val();
                var IsEntry = $("#IsEntry").val();
                var Remark = $("#Remark").val();
                var start_TraceTime = $("#start_TraceTime").val();//起始联系时间
                var end_TraceTime = $("#end_TraceTime").val();//终止联系时间
                var start_ForwardDate = $("#start_ForwardDate").val();//起始预面试时间
                var end_ForwardDate = $("#end_ForwardDate").val();//终止预面试时间
                layui.use(['table'], function () {
                    var table = layui.table;
                    table.reload('myrptData', {
                        page: {
                            curr: 1 //重新从第 1 页开始
                        }, where: {
                            AppCondition: name + "," + deptid + "," + pid + "," + PhoneNumber + "," + Channel + "," + ResumeType + "," + result + "," + IsEntry + "," + start_TraceTime + "," + end_TraceTime + "," + start_ForwardDate + "," + end_ForwardDate
                        }
                    });
                });



            });
            //日期
            var start_TraceTime = laydate.render({
                elem: '#start_TraceTime',
                type: 'datetime',
                done: function (value, date) {
                    end_TraceTime.config.min = {
                        year: date.year,
                        month: date.month - 1//关键

                    }
                }
            });
            var end_TraceTime = laydate.render({
                elem: '#end_TraceTime',
                type: 'datetime',
                done: function (value, date) {
                    start_TraceTime.config.max = {
                        year: date.year,
                        month: date.month - 1//关键

                    }
                }
            });
            var start_ForwardDate = laydate.render({
                elem: '#start_ForwardDate',
                type: 'datetime',
                done: function (value, date) {
                    end_ForwardDate.config.min = {
                        year: date.year,
                        month: date.month - 1//关键

                    }
                }
            });
            var end_ForwardDate = laydate.render({
                elem: '#end_ForwardDate',
                type: 'datetime',
                done: function (value, date) {
                    start_ForwardDate.config.max = {
                        year: date.year,
                        month: date.month - 1//关键

                    }
                }
            });

            //头工具栏事件
            table.on('toolbar(rptTab)', function (obj) {
                //var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'addRPT':
                        AddRPT();
                        break;
                };
            });

            //工具栏事件
            table.on('tool(rptTab)', function (obj) {
                var data = obj.data;
                switch (obj.event) {
                    case 'addTrack':
                        AddTrack(data.Id);
                        break;
                    case 'edit':
                        EditTrace(data.Id);
                        break;
                    case 'detail':
                        DetailTrace(data.Id);
                        break;
                    case 'Entry':
                        ConfirmEntry(data.Id);
                };
            });

            //监听是否入职操作
            form.on('switch(entryDemo)', function (obj) {
                var id = this.value;
                $.ajax({
                    type: "get",
                    dataType: "json",
                    url: "/Personnelmatters/RecruitingDataSummary/EditRptIsentry",
                    data: { id: id, isdel: obj.elem.checked },
                    success: function (data) {
                        // layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);
                        layui.table.reload('myRecruitData');
                    }
                });
            });

            //监听是否面试操作
            form.on('switch(IsInterviewDemo)', function (obj) {
                var id = this.value;
                $.ajax({
                    type: "get",
                    dataType: "json",
                    url: "/Personnelmatters/RecruitingDataSummary/EditRptIsInterview",
                    data: { id: id, isdel: obj.elem.checked },
                    success: function (data) {
                        // layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);
                        layui.table.reload('myRecruitData');
                    }
                });
            });
            formtrace
        });

        //月度招聘数据汇总
        layui.use(['table', 'layer', 'form', 'laydate', 'element'], function () {
            var table = layui.table;
            var layer = layui.layer;
            var form = layui.form;
            var laydate = layui.laydate;
            var element = layui.element;

            table.render({
                elem: '#recruitTab'
                , url: '/Personnelmatters/RecruitingDataSummary/GetRecruitData'
                , id: "myRecruitData"
                , toolbar: '#toolbarDemo3'
                , limits: [1, 3, 6, 9, 12, 15, 18]
                , limit: 6
                , cols: [[
                    , { field: 'YearAndMonth', title: '月份', sort: true, width: 82, templet: function (d) { return GetYearAndMonth(d.YearAndMonth); } }
                    , { field: 'pname', title: '岗位', width: 100, sort: true }
                    , { field: 'PlanRecruitNum', title: '计划招聘人数', width: 115, edit: 'text' }
                    , { field: 'ResumeSum', title: '简历总数', width: 100 }
                    , { field: 'OutboundCallSum', title: '电话呼出总数', width: 115 }
                    , { field: 'InstantInviteSum', title: '当月邀约总数', width: 115 }
                    , { field: 'InstantToFacesSum', title: '当月到面总数', width: 115 }
                    , { field: 'InstantRetestSum', title: '当月复试总数', width: 115 }
                    , { field: 'InstantRetestPassSum', title: '当月复试通过总数', width: 145 }
                    , { field: 'InstantEntryNum', title: '当月入职人数', width: 115 }
                    , { field: 'InstantToFacesRate', title: '当月到面率', width: 105 }
                    , { field: 'InstantInviteRate', title: '当月邀约率', width: 105 }
                    , { field: 'InstantRetestPassrate', title: '当月复试通过率', width: 130 }
                    , { field: 'EntryRate', title: '入职率', width: 90 }
                    , { field: 'RecruitPercentage', title: '招聘完成率', width: 105 }
                    , { field: 'Remark', title: '备注', width: 150, edit: 'text' }

                ]]
                , page: true
            });

            //监听单元格编辑
            table.on('edit(recruitTab)', function (obj) {
                var value = obj.value //得到修改后的值
                    , data = obj.data //得到所在行所有键值
                    , field = obj.field; //得到字段
                $.ajax({
                    type: "get",
                    dataType: "json",
                    url: "/Personnelmatters/RecruitingDataSummary/EditTableCell",
                    data: { id: data.Id, attribute: field, endvalue: value },
                    success: function (data) {
                        console.log("单元格结果：" + data);
                        if (data.Success) {
                            //  layer.msg('[ID: ' + data.EmployeeId + '] ' + field + ' 字段更改为：' + value);
                            layui.table.reload('myRecruitData');
                        } else {
                            layer.msg("修改失败!");
                        }
                    }
                });

            });

            //动态绑定岗位属性的下拉框的值
            $.ajax({
                url: '/Personnelmatters/RecruitingDataSummary/BindPidSelect',
                dataType: 'json',
                type: 'get',
                success: function (data) {
                    console.log(data.data);
                    $.each(data.data, function (index, item) {
                        $('#Pid').append(new Option(item.PositionName, item.Pid));// 下拉菜单里添加元素
                    });
                    layui.form.render("select");
                    //重新渲染 固定写法
                }
            });

            //模糊查询点击事件
            $("#Conditionselect").click(function () {
                var deptid = $("#deptid").val();
                var pname = $("#Pid").val();//员工所属岗位
                var start_time = $("#start_time").val();//起始时间
                var end_time = $("#end_time").val();//终止时间

                layui.use(['table'], function () {
                    var table = layui.table;
                    table.reload('myRecruitData', {
                        page: {
                            curr: 1 //重新从第 1 页开始
                        }, where: {
                            AppCondition: deptid + "," + pname + "," + start_time + "," + end_time
                        }
                    });
                });



            });
            //日期
            var startTime = laydate.render({
                elem: '#start_time',
                format: 'yyyy-MM',
                done: function (value, date) {
                    endTime.config.min = {
                        year: date.year,
                        month: date.month - 1//关键
                        //date: date.date,
                        //hours: date.hours,
                        //minutes: date.minutes,
                        //seconds: date.seconds
                    }
                }
            });
            var endTime = laydate.render({
                elem: '#end_time',
                format: 'yyyy-MM',
                done: function (value, date) {
                    startTime.config.max = {
                        year: date.year,
                        month: date.month - 1//关键
                        //date: date.date,
                        //hours: date.hours,
                        //minutes: date.minutes,
                        //seconds: date.seconds
                    }
                }
            });

        });


        //添加招聘电话追踪记录
        function AddRPT() {
            layui.use(['layer'], function (args) {
                var layer = layui.layer;      //layui对象
                layer.open({
                    type: 2
                    , area: ["900px", "600px"]
                    , title: "添加招聘电话追踪信息"
                    , content: '/Personnelmatters/RecruitingDataSummary/Addrpt'
                    , anim: 2
                });

            })
        }

        //添加面试记录
        function AddTrack(id) {
            layui.use(['layer'], function (args) {
                var layer = layui.layer;      //layui对象
                layer.open({
                    type: 2
                    , area: ["600px", "500px"]
                    , title: "添加追踪记录"
                    , content: '/Personnelmatters/RecruitingDataSummary/AddTrack?id=' + id
                    , anim: 2
                });

            })
        }

        //编辑招聘电话追踪
        function EditTrace(id) {
            layui.use(['layer'], function (args) {
                var layer = layui.layer;      //layui对象
                layer.open({
                    type: 2
                    , area: ["1060px", "620px"]
                    , title: "编辑招聘电话追踪数据"
                    , content: '/Personnelmatters/RecruitingDataSummary/EditTrack?id=' + id
                    , anim: 2
                });

            })
        }

        //招聘电话追踪详情
        function DetailTrace(id) {
            layui.use(['layer'], function (args) {
                var layer = layui.layer;      //layui对象
                layer.open({
                    type: 2
                    , area: ["1060px", "620px"]
                    , title: "招聘电话追踪数据详情"
                    , content: '/Personnelmatters/RecruitingDataSummary/TrackDetailInfo?id=' + id
                    , anim: 2
                });

            })
        }

        //确认入职
        function ConfirmEntry(id) {
            $.ajax({
                type: "get",
                dataType: "json",
                url: '/Personnelmatters/RecruitingDataSummary/GetRPTById/?id=' + id,
                // data: data.EmployeeId,
                success: function (data) {
                    if (data.IsEntry) {
                        layer.msg("该应聘者已入职！");
                        //layui.table.reload('myEmpInfo');
                    } else {
                        layer.open({
                            type: 2
                            , area: ["1300px", "720px"]
                            , title: "填写应聘者入职信息"
                            , content: '/Personnelmatters/RecruitingDataSummary/IsEntry?id=' + id
                            , anim: 2
                        });
                    }
                }
            });

        }

        //格式化时间
        //只显示年月
        function GetYearAndMonth(cellval) {
            if (cellval != null) {
                var date;
                if (cellval.indexOf("/Date(") >= 0) {
                    date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
                }
                else {
                    date = new Date(cellval);
                }

                var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                var minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                var ss = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                return date.getFullYear() + "-" + month;
            } else {
                return "";
            }
        }
        //显示年月日
        function GetYMD(cellval) {
            if (cellval != null) {
                var date;
                if (cellval.indexOf("/Date(") >= 0) {
                    date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
                }
                else {
                    date = new Date(cellval);
                }

                var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                var minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                var ss = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                return date.getFullYear() + "-" + month + "-" + currentDate;
            } else {
                return "";
            }
        }
        //显示具体年月日时分秒的时间
        function changeDateTimeFormat(cellval) {
            if (cellval != null) {
                var date;
                if (cellval.indexOf("/Date(") >= 0) {
                    date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
                }
                else {
                    date = new Date(cellval);
                }

                var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                var minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                var ss = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                return date.getFullYear() + "-" + month + "-" + currentDate + " " + hour + ":" + minute + ":" + ss;
            } else {
                return "";
            }
        }
    </script>

    @*(追踪表的条件查询)部门与岗位的下拉框动态赋值及下拉框二级联动*@
    <script>
        layui.use(['form', 'upload', 'layer'], function () {
            var form = layui.form;
            $.ajax({
                url: '/Personnelmatters/EmployeesInfo/BindDeptSelect',
                data: {},
                dataType: "json",
                success: function (resultData) {
                    $("#deptid1").empty();
                    if (resultData.code == 0) {
                        $("#deptid1").append(new Option("请选择部门", ""));
                        $.each(resultData.data, function (index, item) {
                            $("#deptid1").append(new Option(item.DeptName, item.DeptId));
                        });
                    } else {
                        $("#deptid1").append(new Option("暂无数据", ""));
                    }
                    layui.form.render("select");
                }
            });

            //级联子项目
            //select 监听
            form.on('select(deptid1filter)', function (data) {
                var value = data.value;  //select选中的值
                $.ajax({
                    url: "/Personnelmatters/EmployeesInfo/BindPositionSelect",
                    data: { deptid: value },
                    dataType: "json",
                    success: function (resultData) {
                        if (resultData.code == 0) {
                            //清空赋值
                            $("#Pid1").empty();
                            $("#Pid1").append(new Option("请选择岗位", ""));

                            $.each(resultData.data, function (index, item) {
                                //赋值
                                $("#Pid1").append(new Option(item.PositionName, item.Pid));
                            });
                        } else {
                            $("#Pid1").append(new Option("暂无数据", ""));
                        }
                        layui.form.render("select");
                    }
                });
            })
            layui.form.render("select");

        });


    </script>


    @*部门与岗位的下拉框动态赋值及下拉框二级联动*@
    <script>
        layui.use(['form', 'upload', 'layer'], function () {
            var form = layui.form;
            $.ajax({
                url: '/Personnelmatters/EmployeesInfo/BindDeptSelect',
                data: {},
                dataType: "json",
                success: function (resultData) {
                    $("#deptid").empty();
                    if (resultData.code == 0) {
                        $("#deptid").append(new Option("请选择部门", ""));
                        $.each(resultData.data, function (index, item) {
                            $("#deptid").append(new Option(item.DeptName, item.DeptId));
                        });
                    } else {
                        $("#deptid").append(new Option("暂无数据", ""));
                    }
                    layui.form.render("select");
                }
            });

            //级联子项目
            //select 监听
            form.on('select(deptidfilter)', function (data) {
                var value = data.value;  //select选中的值
                $.ajax({
                    url: "/Personnelmatters/EmployeesInfo/BindPositionSelect",
                    data: { deptid: value },
                    dataType: "json",
                    success: function (resultData) {
                        if (resultData.code == 0) {
                            //清空赋值
                            $("#Pid").empty();
                            $("#Pid").append(new Option("请选择岗位", ""));

                            $.each(resultData.data, function (index, item) {
                                //赋值
                                $("#Pid").append(new Option(item.PositionName, item.Pid));
                            });
                        } else {
                            $("#Pid").append(new Option("暂无数据", ""));
                        }
                        layui.form.render("select");
                    }
                });
            })
            layui.form.render("select");

        });


    </script>



}

