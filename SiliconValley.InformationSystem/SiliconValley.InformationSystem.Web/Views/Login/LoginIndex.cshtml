
@{
    Layout = null;
}

<!DOCTYPE html>
                                                                                                                 
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Login</title>
    <script src="http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"></script>
</head>
<body>
    <link rel="stylesheet" type="text/css" href="~/Content/Login/style.css" />
    <link href="~/Scripts/vendor/layui/css/layui.css" rel="stylesheet" />
    <style type="text/css">
        .btn_tab_login {
            float: right;
            margin-top: 48px;
        }

            .btn_tab_login li {
                display: inline-block;
                margin-left: 30px;
                font-size: 14px;
            }

                .btn_tab_login li.cur a {
                    color: #d00;
                }

        .login-wrap {
            background-image: url('../../Images/Login/Middle.jpg');
            background-size: 100% 100%;
            background-repeat: no-repeat;
        }

        #header {
            background-image: url('../../Images/Login/titlie.jpg');
            background-size: 100% 100%;
            background-repeat: no-repeat;
        }

        #imgtop {
            width: 99%;
            height: 42px;
            background-image: url('../../Images/Login/xyxq.png');
            background-position-y: 43px;
            background-position-x: 32px;
            background-size: 100%;
        }
    </style>
    <script type="text/javascript" src="~/Scripts/jquery-3.3.1.js"></script>
    <script src="~/Scripts/vendor/layui/layui.js"></script>
    
    <div id="header">

        @*<img src="~/Images/Login/titlie.jpg" style="height:84px;width:100%;" />*@
    </div>


    <style type="text/css">
        #weixin_login_container iframe {
            width: 158px;
            height: 158px;
        }
    </style>
    <div class="login-wrap" style=" margin-top:-1px;">
        <div class="wrap clearfix">

            <div class="form-box fr loginV2" style="display:block;">
                <ul class="form-tab clearfix">
                    <li class="tab-li"><a href="javascript:;" onclick="setLoginType('weixin');" tjjj="passport.login_type.wixin_qrcode">微信登录<i class="icon"></i></a></li>
                    <li class="tab-li cur"><a href="javascript:;" onclick="setLoginType('account');" tjjj="passport.login_type.login_name">账号登录</a></li>
                </ul>
                <div class="form-con">
                    <div class="weixin-login" style="display:none;">
                        <div class="wx-box clearfix">
                            <a href="javascript:;" class="wx-img-box">
                                @*<img class="wx-qrCode" src="/images/Login/ewm.jpg" id="qrCodeImg">
                                    <img class="wx-qrCode-logo" src="/images/Login/ewm.jpg" id="qrCodeLogo">
                                    <img class="statusImg" src="/images/Login/wx-confirm.png" id="statusImg">*@
                                <div id="weixin_login_container"></div>
                            </a>
                            <img src="/images/Login/wx-image.png" class="wx-image">
                        </div>
                        <p class="wx-text">微信扫一扫  快速登录</p>
                        <p class="wx-help"><a href="javascript:;" class="help-a">如何使用？</a></p>
                    </div>
                    <div class="login-normal" style="display:block;">
                        <form id="nameLoginForm" class="layui-form" method="post" onkeydown="keyLogin()" autocomplete="off" onsubmit="return nameLoginCheck()">
                            <div class="form-error" style=""><i></i><label class="text"></label></div>
                            <dl class="clearfix">
                                <dt>账户名：</dt>
                                <dd><input type="text" name="UserName" id="normalUser" placeholder="用户名/邮箱/手机号" class="input-text" autocomplete="off" /><span class="placeholder"></span></dd>
                            </dl>
                            <dl class="top1 clearfix">
                                <dt>密<em></em>码：</dt>
                                <dd><input type="password" name="password" id="normalPassword" placeholder="请输入密码" class="input-text"><span class="placeholder"></span></dd>
                            </dl>

                            <div class="form-remember">

                                <input name="rememberName" type="checkbox" id="remUser" class="rem-check" style="display:none;" checked="checked">
                                <span class="rem-box rem-box-r memCheck"><input name="rememberMe" type="checkbox" id="remLogin" class="rem-check">三个月之内免登录</span>
                            </div>
                            <div class="btn-box clearfix">
                                @*<input id="normalSubmit" class="btn-settlement" type=submit value="登    录" tjjj="passport.button.login">*@
                                <input type="button" class="submit btn-settlement" id="btn" loginType="account" tabindex="3" value="登    录" lay-submit lay-filter="subone"/>
                            </div>
                            <div class="link-box clearfix">
                                <a href="javascript:;" class="register" tjjj="passport.login.fstreg">新用户注册</a>
                                <a href="javascript:;" class="forget-pass" tjjj="passport.forget.password">忘记密码？</a>
                            </div>
                        </form>
                        <div class="login-short clearfix">
                            <div class="short-left">
                                <h3>使用合作账号登录：</h3>
                                <ul class="clearfix">
                                    <li class="qq"><a a href="javascript:;" tjjj="passport.login.thd.login.qq"></a></li>
                                    <li class="sina"><a href="javascript:;" tjjj="passport.login.thd.login.sina"></a></li>
                                    <li class="weixin"><a href="javascript:;" tjjj="passport.login.thd.login.weixin"></a></li>
                                </ul>
                            </div>
                            <div class="short-right">
                                <h3>您还可以选择：</h3>
                                <p class="phone-short clearfix">
                                    <i class="phone"></i>
                                    <a href="javascript:;" onclick="setLoginType('phone');" tjjj="" class="txt phoneLogin">手机快捷登录</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- -快捷登录 -->
            <div class="form-box fr shortLogin" style="display:none;">
                <h5 class="title">快捷登录</h5>
                <div class="form-con">
                    <form id="mobileLoginForm" class="layui-form" method="post" onsubmit="return mobileLoginCheck();">
                        <div class="form-error" style=""><i></i><label class="text"></label></div>
                        <dl class="clearfix">
                            <dt>手机号：</dt>
                            <dd><input name="mobile" type="text" id="partnerPhone" autocomplete="off" class="input-text mobile" maxlength="11" onblur="mobileCheck(this);"><span class="placeholder">请输入手机号</span></dd>
                        </dl>
                        <dl class="top1 clearfix">
                            <dt>验证码：</dt>
                            <dd>
                                <input name="smsCaptcha" type="text" id="partnerYzm" class="input-yzm" onblur="captchCheck(this);" maxlength="4" autocomplete="off" />
                                <span class="span-yzm">
                                    <img id="smsCaptchaImage" src="/login/getcode" title="点击图片刷新校验码" alt="点击图片刷新校验码" onclick="changeCode();" />
                                    <a href="javascript:changeCode();" class="forget-pass">换一张</a>
                                </span>
                            </dd>
                        </dl>
                        <dl class="top2 clearfix">
                            <dt>校验码：</dt>
                            <dd>
                                <input name="code" type="text" id="partnerJym" class="input-jym" maxlength="6" autocomplete="off" />
                                <a id="smsSendButton" href="javascript:sendSms(this);" class="span-jym disabled" tjjj="passport.send.msg">发送短信校验码</a>
                            </dd>
                        </dl>
                        <div class="form-remember">

                            <input name="rememberName" type="checkbox" id="remUser" class="rem-check" style="display:none;" checked="checked">
                            <span class="rem-box rem-box-r"><input name="rememberMe" type="checkbox" id="remLogin" class="rem-check">三个月之内免登录</span>
                        </div>
                        <div class="btn-box clearfix">
                            <input id="partnerSubmit" class="btn-settlement" type="button" value="登    录" tjjj="passport.quick.button.login" lay-submit lay-filter="subone">

                        </div>
                        <div class="link-box clearfix">
                            <a href="javascript:;" onclick="setLoginType('account');" class="backLogin">返回账号登录>></a>
                        </div>
                    </form>

                </div>
            </div>

        </div>
    </div>
    <div id="jia_footer">
        <div class="jia_foot_info">
            <div class="jia_foot_con">
                <p class="jia_foot_link">
                    <a href="http://www.hnguigu.com/guigu/kecheng/" rel="nofollow" target="_blank">新闻中心</a><span class="jia_split">|</span> <a href="http://www.hnguigu.com/guigu/jiuye/jiuyefuwu/" target="_blank" rel="nofollow">就业服务</a><span class="jia_split">|</span> <a href="http://www.hnguigu.com/guigu/shizi/" target="_blank" rel="nofollow">名师风采</a><span class="jia_split">|</span> <a href="http://www.hnguigu.com/guigu/jianjie/xiaoyuanhuanjing/" target="_blank" rel="nofollow">学校环境</a><span class="jia_split">|</span> <a href="http://www.11467.com/changsha/co/242870.htm" target="_blank" rel="nofollow">企业文化</a><span class="jia_split">|</span> <a href="javascript:;/link.html" target="_blank" rel="nofollow">友情链接</a><span class="jia_split">|</span> <a href="http://www.hnguigu.com/guigu/lianxiwomen/" target="_blank" rel="nofollow">学院地址</a><span class="jia_split">|</span> <a href="http://weibo.com/hnguigu" tjjj="sjrz.2" target="_blank" rel="nofollow">官方微博</a><span class="jia_split">|</span><a href="http://www.hnguigu.com/guigu/jianjie/guanyuwomen/" rel="nofollow" target="_blank">学院简介</a><span class="jia_split">|</span> <a href="jhttp://www.hnguigu.com/guigu/jiuye/jiuyexueyuan/" tjjj="bottom.link">成功学子</a><span class="jia_split">|</span> <a href="http://www.hnguigu.com/guigu/lianxiwomen/lianxiwomen/" class="jia_foot_open">联系我们<i></i></a>
                </p>

            </div>
        </div>
    </div>
    <div style="width:99%;">

        <div style="float:left;margin-left: 24%;">
            <div style="float:left"><img style="width:76px;" src="~/Images/Login/ksrl.png" /></div>
            <div style="float:left;padding-left:20px;">
                <div style="height:16px;"></div>
                <span style="font-size:18pt;font-weight:600;color:dodgerblue;">快速入职</span><br />
                <span style="color:dodgerblue;font-size:12pt">入职手续不再繁琐</span>
            </div>
        </div>
        <div style="float:left; padding-left:40px;">
            <div style="float:left"><img style="width:76px;" src="~/Images/Login/ysbh.png" /></div>
            <div style="float:left;padding-left:20px;">
                <div style="height:16px;"></div>
                <span style="font-size:18pt;font-weight:600;color:dodgerblue;">隐私保护</span><br />
                <span style="color:dodgerblue;font-size:12pt">入职手续不再繁琐</span>
            </div>
        </div>
        <div style="float:left; padding-left:40px;">
            <div style="float:left"><img style="width:76px;" src="~/Images/Login/zyby.png" /></div>
            <div style="float:left;padding-left:20px;">
                <div style="height:16px;"></div>
                <span style="font-size:18pt;font-weight:600;color:dodgerblue;">资源备用</span><br />
                <span style="color:dodgerblue;font-size:12pt">防止学院资源外漏</span>
            </div>
        </div>
        <div style="float:left; padding-left:40px;">
            <div style="float:left"><img style="width:76px;" src="~/Images/Login/hlxx.png" /></div>
            <div style="float:left;padding-left:20px;">
                <div style="height:16px;"></div>
                <span style="font-size:18pt;font-weight:600;color:dodgerblue;">海量信息</span><br />
                <span style="color:dodgerblue;font-size:12pt">海量学院信息实时更新</span>
            </div>
        </div>
    </div><br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <div id="imgtop"></div>
</body>
</html>
<script type="text/javascript">
    var _wx_server_qr_code_count = 0;
    var _wx_server_qr_code_loaded = false;
    var _qr_code_limited = '';
    var _qr_code_wait_time = 20;
    var flashQrCodeWaitingTimer = null;
    var getQrCodeStatusTimer = null;
    var getQrCodeTimer = null;


    function keyLogin(event) {

        //谷歌能识别event，火狐识别不了，所以增加了这一句，chrome浏览器可以直接支持event.keyCode  
        var theEvent = window.event || arguments.callee.caller.arguments[0];

        var key = theEvent.keyCode;
        function nameLoginCheck() {
        var loginName = $("#nameLoginForm").find("#normalUser").eq(0).val();
        var password = $("#nameLoginForm").find("#normalPassword").eq(0).val();
        if ($(".tips ").is(":visible")) {
            return false;
        }
        if (loginName == null || loginName == "") {
            showError("请输入用户名");
            return false;
        }
        if (password == null || password == "") {
            showError("请输入密码");
            return false;
        }
        if ($("#normalYzm") && $("#nameLoginForm").find("#normalYzm").length > 0) {
            if ($("#normalYzm").val() == "" || $("#normalYzm").val() == null) {
                showError("请输入验证码");
                return false;
            }
        }
        return true;
    }
        if (key == 13) {//回车键的键值为13
                 nameLoginCheck();
                var toClick = document.getElementById("btn");
                toClick.click();  //调用登录按钮的登录事件
        }
    }


    //function nameLoginCheck() {
    //    var loginName = $("#nameLoginForm").find("#normalUser").eq(0).val();
    //    var password = $("#nameLoginForm").find("#normalPassword").eq(0).val();
    //    if ($(".tips ").is(":visible")) {
    //        return false;
    //    }
    //    if (loginName == null || loginName == "") {
    //        showError("请输入用户名");
    //        return false;
    //    }
    //    if (password == null || password == "") {
    //        showError("请输入密码");
    //        return false;
    //    }
    //    if ($("#normalYzm") && $("#nameLoginForm").find("#normalYzm").length > 0) {
    //        if ($("#normalYzm").val() == "" || $("#normalYzm").val() == null) {
    //            showError("请输入验证码");
    //            return false;
    //        }
    //    }
    //    return true;
    //}

    //页面加载事件
    $(document).ready(function () {
        var obj = new WxLogin
            ({
                id: "weixin_login_container",//div的id
                appid: "wx9a441f4d4496906a",
                scope: "snsapi_login",//写死
                redirect_uri: encodeURI("http://www.guiguxinxihua.com/WeiXin/WXLogin"),
                state: "",
                style: "black",//二维码黑白风格        
                href: "data:text/css;base64,LmltcG93ZXJCb3ggLnFyY29kZSB7CiAgICB3aWR0aDogMTU4cHg7CiAgICBwYWRkaW5nOjBweDsKICAgIG1hcmdpbjowcHg7Cn0KCi5pbXBvd2VyQm94IC50aXRsZSB7CiAgICBkaXNwbGF5OiBub25lOwp9CgouaW1wb3dlckJveCAuaW5mbyB7CiAgICB3aWR0aDogMTU4cHg7Cn0KCi5zdGF0dXNfaWNvbiB7CiAgICBkaXNwbGF5OiBub25lCn0KCi5pbXBvd2VyQm94IC5zdGF0dXMgewogICAgdGV4dC1hbGlnbjogY2VudGVyOwp9"
            });
    });

    //切换验证码
    function changeCode() {
        var r = Math.random();
        $("#smsCaptchaImage").attr("src", "/login/getcode?r=" + r);
    }

    //设置登录类型
    function setLoginType(logintype) {
        
        $(".submit").attr("loginType", logintype);
       
    }

    //手机登陆验证
    function mobileLoginCheck() {
        var mobile = $("#mobileLoginForm").find("#partnerPhone").eq(0).val();
        var captch = $("#mobileLoginForm").find("#partnerYzm").eq(0).val();
        var code = $("#mobileLoginForm").find("#partnerJym").eq(0).val();
       
       
      
        if (mobile == null || mobile == '') {
           
            showError("请填写正确的手机号");
            return false;
        }
        if (captch == null || captch == '' || captch == undefined) {
           
            showError("请填写验证码");
            return false;
        }
        if (code == null || code == '') {
          
            showError("请填写校验码");
            return false;
        }
        return true;
    }

    function mobileCheck(obj) {
        //if (!(_mobile_reg).test($("#partnerPhone").val())) {
        //    showError("请填写正确的手机号");
        //    return;
        //} else {
        //    closeError();
        //}
    }

    //发送短信
    function sendSms(obj) {
        var pn = $("#partnerPhone").val();
        $.ajax({
            url: "/Login/GetPhoneCode?mobile="+pn,
           
            type: "GET",
            success: function (data) {
                if (data.Success == true) {
                    alert("校验码已发送至  " + pn);
                    //window.location.href = data.Data;
                } else {
                    //配置一个透明的询问框
                    showError(data.Msg);
                }
            }
        });
       
    }

    function captchCheck(obj) {
        //if (!(_mobile_reg).test($("#partnerPhone").val())) {
        //    showError("请填写正确的手机号");
        //    return;
        //}
        var captch = $(obj).val();
       
        if (captch == '' || captch == null) {
            showError("请填写验证码");
            return;
        } else {
            //checkCaptch(captch,
            //    function () {
            //        if (!$("#smsSendButton").hasClass("sending")) {
            //            $("#smsSendButton").removeClass("disabled");
            //        }
            //        closeError();
            //    }, function () {
            //        showError("验证码错误");
            //        $("#smsSendButton").addClass("disabled");
            //    }
            //);
        }
    }
    $(function () {
        $(".form-tab li").on("click", function () {
            var index = $(this).index();
            $(this).addClass("cur").siblings().removeClass("cur");
            $(".form-con>div").hide().eq(index).show();
            if (index == 0) {
                $(".form-foot").hide();
            } else {
                $(".form-foot").show();
                
            }
            $(".form-error").hide();
        });
        $(".weixin-login .help-a").hover(
            function () {
                $(".wx-img-box,.wx-image").stop();
                $(this).parents(".weixin-login").find(".wx-img-box").animate({ "marginLeft": "15px" }, 300, function () {
                    $(this).parents(".weixin-login").find(".wx-image").animate({ "opacity": 1 }, 300);
                });
            },
            function () {
                $(".wx-img-box,.wx-image").stop();
                $(this).parents(".weixin-login").find(".wx-image").stop().animate({ "opacity": 0 }, 300, function () {
                    $(this).parents(".weixin-login").find(".wx-img-box").animate({ "marginLeft": "110px" }, 300);
                });
            }
        );


    });

    $('.jia_foot_open').click(function () {
        $('.footnone').slideToggle();
        $(this).find('i').toggleClass('footnow');
    });
    $('.phoneLogin').click(function () {
        $('.loginV2').hide();
        $('.shortLogin').show();
        $('.form-error').hide();
    });
    $('.backLogin').click(function () {
        $('.login-normal').show();
        $('.loginV2').show();
        $('.shortLogin').hide();
        $('.form-error').hide();
    });
    //开启错误提示
    function showError(error) {
        $(".form-error").find("label").html(error);
        $(".form-error").show();
    }



    layui.use(['form', 'layedit', 'laydate', 'layer'], function () {
        var form = layui.form;
        var layedit = layui.layedit;
        var laydate = layui.laydate;
        var layer = layui.layer;
        form.on('submit(subone)', function (data) {
           
            var myformdata = data.field;//当前容器的全部表单字段，名值对形式：{name: value}

            var loginType = $(".submit").attr("loginType");
          
            data.field.loginType = loginType

            $.ajax({
                url: "/Login/LoginFunction",
                data: myformdata,
                type: "POST",
                success: function (data) {
                    if (data.Success == true) {
                        window.location.href = data.Data;
                    } else {
                        //配置一个透明的询问框
                        showError(data.Msg);
                    }
                }
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
    });

 
    

    

</script>



